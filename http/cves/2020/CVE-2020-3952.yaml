id: CVE-2020-3952

info:
  name: VMware vCenter Server LDAP Broken Access Control
  author: guardicore,0x_Akoko
  severity: critical
  description: |
    An authentication bypass vulnerability in VMware vCenter Server allows a remote unauthenticated attacker to create LDAP users without authentication via specially crafted LDAP requests. This vulnerability affects vCenter Server versions 6.7 prior to 6.7 U3f, 6.5 prior to 6.5 U3e, and 7.0 prior to 7.0 U1c.
  remediation: |
    Update VMware vCenter Server to version 7.0 U1c or later, 6.7 U3f or later, or 6.5 U3e or later.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2020-3952
    - https://www.vmware.com/security/advisories/VMSA-2020-0006.html
    - https://github.com/guardicore/vmware_vcenter_cve_2020_3952
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2020-3952
    cwe-id: CWE-306
    epss-score: 0.93234
    epss-percentile: 0.99787
    cpe: cpe:2.3:a:vmware:vcenter_server:6.7:-:*:*:*:*:*:*
  metadata:
    verified: true
    vendor: vmware
    product: vcenter_server
    shodan-query: http.title:"vmware vcenter"
    fofa-query: title="vmware vcenter"
    google-query: intitle:"vmware vcenter"
  tags: cve,cve2020,vmware,vcenter,ldap,auth-bypass,passive,kev

http:
  - raw:
      - |
        POST /sdk/ HTTP/1.1
        Host: {{Hostname}}
        Content-Type: text/xml
        SOAPAction: "urn:vim25/6.5"

        <?xml version="1.0" encoding="UTF-8"?>
        <soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
           <soap:Header>
              <operationID>00000001-00000001</operationID>
           </soap:Header>
           <soap:Body>
              <RetrieveServiceContent xmlns="urn:internalvim25">
                 <_this xsi:type="ManagedObjectReference" type="ServiceInstance">ServiceInstance</_this>
              </RetrieveServiceContent>
           </soap:Body>
        </soap:Envelope>

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        part: body
        words:
          - 'RetrieveServiceContentResponse'
          - 'urn:vim'
        condition: or

      - type: word
        part: header
        words:
          - "text/xml"

      - type: dsl
        dsl:
          - "(version == '6.7.0' && compare_versions(build, '<= 14367737'))"
          - "(version == '6.5.0' && compare_versions(build, '<= 14020092'))"
        condition: or

    extractors:
      - type: regex
        group: 1
        regex:
          - "<n>(.*?)</n>"
          - "<version>(.*?)</version>"
          - "<build>(.*?)</build>"
          - "<osType>(.*?)</osType>"
          - "<productLineId>(.*?)</productLineId>"
          - "<apiType>(.*?)</apiType>"
